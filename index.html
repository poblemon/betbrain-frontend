<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BetBrain IA - Chatbot Experto</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes slideIn {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .chat-bubble { animation: slideIn 0.3s ease-out; }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900">
    <div id="root"></div>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <script>
        const { useState, useEffect, useRef, createElement: e } = React;
        const API = 'https://betbrain-backend.onrender.com/api';
        
        function ChatBot({ matches }) {
            const [open, setOpen] = useState(false);
            const [messages, setMessages] = useState([
                { role: 'assistant', content: '¬°Hola! üëã Soy tu asistente BetBrain IA. ¬øEn qu√© puedo ayudarte hoy?' }
            ]);
            const [input, setInput] = useState('');
            const [loading, setLoading] = useState(false);
            const messagesEnd = useRef(null);
            
            useEffect(() => {
                messagesEnd.current?.scrollIntoView({ behavior: 'smooth' });
            }, [messages]);
            
            async function sendMessage() {
                if (!input.trim()) return;
                
                const userMsg = { role: 'user', content: input };
                setMessages(prev => [...prev, userMsg]);
                setInput('');
                setLoading(true);
                
                try {
                    const res = await fetch(`${API}/chatbot`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ message: input, context: { matches } })
                    });
                    const data = await res.json();
                    setMessages(prev => [...prev, { role: 'assistant', content: data.response, data: data }]);
                } catch (err) {
                    setMessages(prev => [...prev, { 
                        role: 'assistant', 
                        content: 'Lo siento, tuve un problema al procesar tu mensaje. ¬øPuedes intentar de nuevo?' 
                    }]);
                }
                setLoading(false);
            }
            
            function quickAction(action) {
                setInput(action);
                setTimeout(() => sendMessage(), 100);
            }
            
            return e('div', { className: 'fixed bottom-6 right-6 z-50' },
                // Bot√≥n flotante
                !open && e('button', {
                    onClick: () => setOpen(true),
                    className: 'bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-full w-16 h-16 shadow-2xl hover:scale-110 transition flex items-center justify-center text-2xl'
                }, 'ü§ñ'),
                
                // Ventana de chat
                open && e('div', { className: 'bg-slate-800 rounded-2xl shadow-2xl w-96 h-[600px] flex flex-col border border-purple-500/30' },
                    // Header
                    e('div', { className: 'bg-gradient-to-r from-purple-600 to-pink-600 p-4 rounded-t-2xl flex justify-between items-center' },
                        e('div', { className: 'flex items-center gap-3' },
                            e('div', { className: 'text-2xl' }, 'ü§ñ'),
                            e('div', {},
                                e('div', { className: 'font-bold' }, 'BetBrain IA'),
                                e('div', { className: 'text-xs opacity-80' }, 'Asistente experto')
                            )
                        ),
                        e('button', {
                            onClick: () => setOpen(false),
                            className: 'text-white/80 hover:text-white text-2xl'
                        }, '√ó')
                    ),
                    
                    // Mensajes
                    e('div', { className: 'flex-1 overflow-y-auto p-4 space-y-4' },
                        messages.map((msg, i) =>
                            e('div', {
                                key: i,
                                className: `chat-bubble flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`
                            },
                                e('div', {
                                    className: `max-w-[80%] rounded-2xl px-4 py-3 ${
                                        msg.role === 'user' 
                                            ? 'bg-gradient-to-r from-purple-600 to-pink-600 text-white' 
                                            : 'bg-slate-700 text-gray-100'
                                    }`
                                }, msg.content)
                            )
                        ),
                        loading && e('div', { className: 'flex justify-start' },
                            e('div', { className: 'bg-slate-700 rounded-2xl px-4 py-3' },
                                e('div', { className: 'flex gap-1' },
                                    [1,2,3].map(i => e('div', {
                                        key: i,
                                        className: 'w-2 h-2 bg-purple-400 rounded-full animate-bounce',
                                        style: { animationDelay: `${i * 0.1}s` }
                                    }))
                                )
                            )
                        ),
                        e('div', { ref: messagesEnd })
                    ),
                    
                    // Acciones r√°pidas
                    messages.length <= 1 && e('div', { className: 'px-4 pb-2 flex flex-wrap gap-2' },
                        ['Dame los mejores picks', 'Quiero ganar ‚Ç¨100', 'Crea una combinada'].map(action =>
                            e('button', {
                                key: action,
                                onClick: () => quickAction(action),
                                className: 'text-xs bg-slate-700 hover:bg-slate-600 px-3 py-2 rounded-full transition'
                            }, action)
                        )
                    ),
                    
                    // Input
                    e('div', { className: 'p-4 border-t border-slate-700' },
                        e('div', { className: 'flex gap-2' },
                            e('input', {
                                type: 'text',
                                value: input,
                                onChange: ev => setInput(ev.target.value),
                                onKeyPress: ev => ev.key === 'Enter' && sendMessage(),
                                placeholder: 'Escribe tu pregunta...',
                                className: 'flex-1 bg-slate-700 rounded-full px-4 py-2 outline-none focus:ring-2 focus:ring-purple-500 text-white placeholder-gray-400'
                            }),
                            e('button', {
                                onClick: sendMessage,
                                disabled: !input.trim(),
                                className: 'bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-full w-10 h-10 flex items-center justify-center disabled:opacity-50 hover:scale-105 transition'
                            }, '‚û§')
                        )
                    )
                )
            );
        }
        
        function App() {
            const [leagues] = useState([
                { id: 2021, name: 'Premier League', flag: 'üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø' },
                { id: 2014, name: 'LaLiga', flag: 'üá™üá∏' },
                { id: 2019, name: 'Serie A', flag: 'üáÆüáπ' },
                { id: 2002, name: 'Bundesliga', flag: 'üá©üá™' }
            ]);
            const [selected, setSelected] = useState(null);
            const [matches, setMatches] = useState([]);
            const [loading, setLoading] = useState(false);
            
            async function loadMatches(league) {
                setLoading(true);
                setSelected(league);
                try {
                    const res = await fetch(`${API}/matches/${league.id}`);
                    const data = await res.json();
                    const processed = (data.matches || []).slice(0, 10).map(m => ({
                        id: m.id,
                        home: m.homeTeam.shortName || m.homeTeam.name,
                        away: m.awayTeam.shortName || m.awayTeam.name,
                        time: new Date(m.utcDate).toLocaleTimeString('es', {hour:'2-digit',minute:'2-digit'}),
                        odds: m.odds || {home:2.1,draw:3.4,away:3.5}
                    }));
                    setMatches(processed);
                } catch(err) {
                    console.error(err);
                } finally {
                    setLoading(false);
                }
            }
            
            return e('div', { className: 'min-h-screen text-white p-6' },
                e('div', { className: 'max-w-7xl mx-auto' },
                    // Header
                    e('div', { className: 'text-center mb-8' },
                        e('h1', { className: 'text-5xl font-bold mb-2' }, '‚öΩ BetBrain IA'),
                        e('p', { className: 'text-gray-300' }, 'Asistente IA para an√°lisis de apuestas'),
                        e('div', { className: 'mt-3 flex items-center justify-center gap-2 text-sm' },
                            e('span', { className: 'bg-green-600/20 text-green-400 px-3 py-1 rounded-full' }, 'ü§ñ Chatbot IA activo'),
                            e('span', { className: 'bg-purple-600/20 text-purple-400 px-3 py-1 rounded-full' }, 'üìä An√°lisis en tiempo real')
                        )
                    ),
                    
                    // Ligas
                    e('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-4 mb-8' },
                        leagues.map(l => 
                            e('button', {
                                key: l.id,
                                onClick: () => loadMatches(l),
                                className: `p-4 rounded-xl transition ${selected?.id === l.id ? 'bg-gradient-to-r from-purple-600 to-pink-600 scale-105' : 'bg-slate-800/50 hover:bg-slate-700/50'}`
                            }, e('div', { className: 'text-3xl mb-2' }, l.flag), e('div', { className: 'text-sm' }, l.name))
                        )
                    ),
                    
                    // Partidos
                    loading ? e('div', { className: 'text-center py-20' },
                        e('div', { className: 'text-6xl mb-4' }, '‚öΩ'),
                        e('div', { className: 'text-xl text-purple-400' }, 'Cargando partidos...')
                    ) :
                    matches.length === 0 ? e('div', { className: 'text-center py-20' },
                        e('div', { className: 'text-6xl mb-4' }, 'üéØ'),
                        e('div', { className: 'text-xl text-gray-400' }, 'Selecciona una liga'),
                        e('div', { className: 'mt-4 text-purple-400' }, 'üí¨ O preg√∫ntale al chatbot ‚Üí')
                    ) :
                    e('div', { className: 'grid md:grid-cols-2 lg:grid-cols-3 gap-4' },
                        matches.map(m =>
                            e('div', {
                                key: m.id,
                                className: 'bg-slate-800/50 rounded-xl p-5 border border-purple-500/20 hover:border-purple-500/50 transition'
                            },
                                e('div', { className: 'text-purple-400 text-sm mb-3' }, m.time),
                                e('div', { className: 'grid grid-cols-3 gap-2 text-center' },
                                    e('div', {},
                                        e('div', { className: 'font-bold mb-1' }, m.home),
                                        e('div', { className: 'text-green-400 text-xl font-bold' }, m.odds.home)
                                    ),
                                    e('div', { className: 'text-gray-400' },
                                        e('div', { className: 'text-sm mb-1' }, 'Empate'),
                                        e('div', { className: 'text-lg font-bold' }, m.odds.draw)
                                    ),
                                    e('div', {},
                                        e('div', { className: 'font-bold mb-1' }, m.away),
                                        e('div', { className: 'text-green-400 text-xl font-bold' }, m.odds.away)
                                    )
                                )
                            )
                        )
                    )
                ),
                
                // Chatbot
                e(ChatBot, { matches })
            );
        }
        
        ReactDOM.createRoot(document.getElementById('root')).render(e(App));
    </script>
</body>
</html>
